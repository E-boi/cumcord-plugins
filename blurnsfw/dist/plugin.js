(function(f,r,d,D,$){"use strict";function T(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(a){if(a!=="default"){var s=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(n,a,s.get?s:{enumerable:!0,get:function(){return e[a]}})}}),n.default=e,Object.freeze(n)}var t=T(D),P=()=>f.injectCSS(":root{--blur-effect: blur(1px);--blur-timing: 1s}.nsfw-text{background-color:#f04747;padding:0 6px;white-space:nowrap;text-overflow:ellipsis;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:8px;min-width:16px;min-height:16px;font-size:12px;line-height:16px;font-weight:600;color:#fff;text-align:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}.nsfw-badge{position:relative;margin-left:4px;line-height:0}.blur [class*=originalLink-]{z-index:0}.blur .embedWrapper-1MtIDg img,.blur .embedWrapper-1MtIDg video{transition:var(--blur-timing)!important;filter:var(--blur-effect)!important}.blur .embedWrapper-1MtIDg img:hover,.blur .embedWrapper-1MtIDg video:hover{transition:var(--blur-timing)!important;filter:none!important}.blurnsfwsetting-textinput{display:flex}.blurnsfwsetting-textinput div{width:-webkit-fill-available}.blurnsfwsetting-textinput button{margin-left:9px}");const h=r.webpack.findByDisplayName("SwitchItem"),o=r.webpack.find(e=>e.DropdownSizes),w={dividerDefault:r.webpack.findByProps("dividerDefault").dividerDefault,divider:r.webpack.find(e=>e.divider?.includes("divider-_")).divider};var v=({className:e})=>t.createElement("div",{className:`${w.divider} ${w.dividerDefault} ${e}`});const S=r.webpack.findByDisplayName("LegacyText"),A=r.webpack.findByDisplayName("ArrowDropDown"),R=r.webpack.findByDisplayName("ArrowDropUp"),i={...r.webpack.findByProps("wrapper","base"),...r.webpack.findByProps("flex"),...r.webpack.findByProps("size20"),...r.webpack.findByProps("marginBottom20"),...r.webpack.findByProps("dividerDefault")};var E=({opened:e,children:n,title:a,onChange:s})=>t.createElement("div",null,t.createElement("div",{onClick:()=>s?.(),className:[i.flex,i.alignCenter,i.marginBottom8].join(" ")},e?t.createElement(R,{className:i.base,width:32,height:32}):t.createElement(A,{className:i.base,width:32,height:32}),t.createElement(S,{className:[i.base,i.size16,i.marginLeft8].join(" ")},a)),e?t.createElement("div",{className:[i.marginLeft8,i.marginBottom20].join(" ")},[...n]):null,!e&&t.createElement(v,{className:i.marginBottom20}));const I=r.webpack.findByDisplayName("FormItem"),L=r.webpack.findByDisplayName("FormText"),l={...r.webpack.findByProps("marginBottom20"),...r.webpack.findByProps("formText"),...r.webpack.findByDisplayName("Flex")};var k=e=>t.createElement(I,{title:e.title,required:e.required,className:`${l.Direction.VERTICAL} ${l.Justify.START} ${l.Align.STRETCH} ${l.Wrap.NO_WRAP} ${l.marginBottom20}`},e.children,e.note&&t.createElement(L,{className:`${l.description} ${l.marginTop8}`},e.note),t.createElement(v,{className:[l.marginTop20].join(" ")}));const j=r.webpack.findByDisplayName("Slider"),M={...r.webpack.findByProps("marginBottom20")};var y=e=>{const n=e.children;return delete e.children,t.createElement(k,{title:n,note:e.note,required:e.required},t.createElement(j,{...e,className:`${e.className} ${M.marginTop8}`}))};const x=r.webpack.findByDisplayName("TextInput");var C=e=>{Array.isArray(e.children)||(e.children=[e.children]);const n=e.children;return delete e.children,t.createElement(k,{title:n[0],required:e.required,note:e.note},n[1]?t.createElement("div",{className:"blurnsfwsetting-textinput"},t.createElement(x,{...e}),n[1]):t.createElement(x,{...e}))},V=({persist:e})=>{const[n,a]=t.useState(),[s,W]=t.useState();return $.useNest(e),t.createElement("div",null,t.createElement(h,{note:"Blur images/video in dms",value:e.ghost.dm,onChange:()=>e.store.dm=!e.ghost.dm},"Blur DMs"),t.createElement(h,{note:"Blur images/video in group chats",value:e.ghost.gc,onChange:()=>e.store.gc=!e.ghost.gc},"Blur Group chats"),t.createElement(h,{note:"Adds a more visible tags for nsfw channels",value:!e.ghost.notags,onChange:()=>e.store.notags=!e.ghost.notags},"NSFW Tags"),t.createElement(y,{stickToMarkers:!0,minValue:1,maxValue:75,initialValue:e.ghost.blur??10,markers:[5,10,15,20,25,30,35,40,45,50,65,60,70,75],onValueChange:c=>e.store.blur=c},"Blur effect"),t.createElement(y,{stickToMarkers:!0,minValue:.2,maxValue:10,initialValue:e.ghost.timing??1,markers:[.2,.5,1,2,3,4,5,6,7,8,9,10],onValueChange:c=>e.store.timing=c},"Blur Timing (in seconds)"),t.createElement(E,{opened:n,onChange:()=>a(!n),title:"Blocked channels (uneffected channels)"},e.ghost.blocked?.map((c,p)=>t.createElement(C,{placeholder:"Enter a channel/user id",value:c,onChange:m=>e.store.blocked[p]=m},"",t.createElement(o,{color:o.Colors.RED,onClick:()=>e.store.blocked=e.ghost.blocked.filter((m,b)=>b!==p)},"Remove"))),t.createElement(o,{onClick:()=>e.store.blocked=e.ghost.blocked?e.ghost.blocked.concat(""):[""]},"Add channel")),t.createElement(E,{opened:s,onChange:()=>W(!s),title:"Blur specific channels"},e.ghost.blurChannels?.map((c,p)=>t.createElement(C,{placeholder:"Enter a channel/user id",value:c,onChange:m=>e.store.blurChannels[p]=m},"",t.createElement(o,{color:o.Colors.RED,onClick:()=>e.store.blurChannels=e.ghost.blurChannels.filter((m,b)=>b!==p)},"Remove"))),t.createElement(o,{onClick:()=>e.store.blurChannels=e.ghost.blurChannels?e.ghost.blurChannels.concat(""):[""]},"Add channel")))};const B=[];let N;const _=r.webpack.findByDisplayName("ChannelItem",!1),{getChannel:z}=r.webpack.findByProps("getChannel","getDMFromUserId");function u({channelId:e}){const n=z(e);this.ghost.blocked?.includes(e)||this.ghost.blocked?.includes(n.recipients[0])||(n.nsfw||n.type===1&&this.ghost.dm||n.type===3&&this.ghost.gc||this.ghost.blurChannels?.includes(n.id)||this.ghost.blurChannels?.includes(n.recipients[0])?g():document.body.classList.remove("blur"))}var F=({persist:e})=>(u=u.bind(e),g=g.bind(e),{onLoad(){N=P(),B.push(f.after("default",_,([{channel:n}],a)=>{!n.nsfw||e.ghost.notags||a.props.children.props.children[1].props.children[1].props.children.push(d.React.createElement("div",{className:"nsfw-badge"},d.React.createElement("div",{className:"nsfw-text"},"NSFW")))})),d.FluxDispatcher.subscribe("CHANNEL_SELECT",u)},onUnload(){d.FluxDispatcher.unsubscribe("CHANNEL_SELECT",u),N?.(),B.forEach(n=>n())},settings:d.React.createElement(V,{persist:e})});function g(){const e=this.ghost.blur||10,n=this.ghost.timing||1,a=document.body;a.style.setProperty("--blur-effect",`blur(${e}px)`),a.style.setProperty("--blur-timing",`${n}s`),a.classList.add("blur")}return F})(cumcord.patcher,cumcord.modules,cumcord.modules.common,cumcord.modules.common.React,cumcord.utils);
