(function(p,a,d,D,T){"use strict";function $(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(r){if(r!=="default"){var c=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,c.get?c:{enumerable:!0,get:function(){return e[r]}})}}),n.default=e,Object.freeze(n)}var t=$(D),I=()=>p.injectCSS(":root{--blur-effect: blur(1px);--blur-timing: 1s}.nsfw-text{background-color:#f04747;padding:0 6px;white-space:nowrap;text-overflow:ellipsis;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:8px;min-width:16px;min-height:16px;font-size:12px;line-height:16px;font-weight:600;color:#fff;text-align:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}.nsfw-badge{position:relative;margin-left:4px;line-height:0}.blur [class*=originalLink-]{z-index:0}.blur .embedWrapper-1MtIDg img,.blur .embedWrapper-1MtIDg video{transition:var(--blur-timing)!important;filter:var(--blur-effect)!important}.blur .embedWrapper-1MtIDg img:hover,.blur .embedWrapper-1MtIDg video:hover{transition:var(--blur-timing)!important;filter:none!important}.blurnsfwsetting-textinput{display:flex}.blurnsfwsetting-textinput div{width:-webkit-fill-available}.blurnsfwsetting-textinput button{margin-left:9px}");const g=a.webpack.findByDisplayName("SwitchItem"),s=a.webpack.find(e=>e.DropdownSizes),w={dividerDefault:a.webpack.findByProps("dividerDefault").dividerDefault,divider:a.webpack.find(e=>e.divider?.includes("divider-_")).divider};var v=({className:e})=>t.createElement("div",{className:`${w.divider} ${w.dividerDefault} ${e}`});const S=a.webpack.findByDisplayName("LegacyText"),A=a.webpack.findByDisplayName("ArrowDropDown"),P=a.webpack.findByDisplayName("ArrowDropUp"),i={...a.webpack.findByProps("wrapper","base"),...a.webpack.findByProps("flex"),...a.webpack.findByProps("size20"),...a.webpack.findByProps("marginBottom20"),...a.webpack.findByProps("dividerDefault")};var E=({opened:e,children:n,title:r,onChange:c})=>t.createElement("div",null,t.createElement("div",{onClick:()=>c?.(),className:[i.flex,i.alignCenter,i.marginBottom8].join(" ")},e?t.createElement(P,{className:i.base,width:32,height:32}):t.createElement(A,{className:i.base,width:32,height:32}),t.createElement(S,{className:[i.base,i.size16,i.marginLeft8].join(" ")},r)),e?t.createElement("div",{className:[i.marginLeft8,i.marginBottom20].join(" ")},[...n]):null,!e&&t.createElement(v,{className:i.marginBottom20}));const R=a.webpack.findByDisplayName("FormItem"),j=a.webpack.findByDisplayName("FormText"),l={...a.webpack.findByProps("marginBottom20"),...a.webpack.findByProps("formText"),...a.webpack.findByDisplayName("Flex")};var y=e=>t.createElement(R,{title:e.title,required:e.required,className:`${l.Direction.VERTICAL} ${l.Justify.START} ${l.Align.STRETCH} ${l.Wrap.NO_WRAP} ${l.marginBottom20}`},e.children,e.note&&t.createElement(j,{className:`${l.description} ${l.marginTop8}`},e.note),t.createElement(v,{className:[l.marginTop20].join(" ")}));const L=a.webpack.findByDisplayName("Slider"),F={...a.webpack.findByProps("marginBottom20")};var k=e=>{const n=e.children;return delete e.children,t.createElement(y,{title:n,note:e.note,required:e.required},t.createElement(L,{...e,className:`${e.className} ${F.marginTop8}`}))};const x=a.webpack.findByDisplayName("TextInput");var C=e=>{Array.isArray(e.children)||(e.children=[e.children]);const n=e.children;return delete e.children,t.createElement(y,{title:n[0],required:e.required,note:e.note},n[1]?t.createElement("div",{className:"blurnsfwsetting-textinput"},t.createElement(x,{...e}),n[1]):t.createElement(x,{...e}))},_=({persist:e})=>{const[n,r]=t.useState(),[c,z]=t.useState();return T.useNest(e),t.createElement("div",null,t.createElement(g,{note:"Blur images/video in dms",value:e.ghost.dm,onChange:()=>e.store.dm=!e.ghost.dm},"Blur DMs"),t.createElement(g,{note:"Blur images/video in group chats",value:e.ghost.gc,onChange:()=>e.store.gc=!e.ghost.gc},"Blur Group chats"),t.createElement(g,{note:"Adds a more visible tags for nsfw channels",value:!e.ghost.notags,onChange:()=>e.store.notags=!e.ghost.notags},"NSFW Tags"),t.createElement(k,{stickToMarkers:!0,minValue:1,maxValue:75,initialValue:e.ghost.blur??10,markers:[5,10,15,20,25,30,35,40,45,50,65,60,70,75],onValueChange:o=>e.store.blur=o},"Blur effect"),t.createElement(k,{stickToMarkers:!0,minValue:.2,maxValue:10,initialValue:e.ghost.timing??1,markers:[.2,.5,1,2,3,4,5,6,7,8,9,10],onValueChange:o=>e.store.timing=o},"Blur Timing (in seconds)"),t.createElement(E,{opened:n,onChange:()=>r(!n),title:"Blocked channels (uneffected channels)"},e.ghost.blocked?.map((o,m)=>t.createElement(C,{placeholder:"Enter a channel/user id",value:o,onChange:u=>e.store.blocked[m]=u},"",t.createElement(s,{color:s.Colors.RED,onClick:()=>e.store.blocked=e.ghost.blocked.filter((u,f)=>f!==m)},"Remove"))),t.createElement(s,{onClick:()=>e.store.blocked=e.ghost.blocked?e.ghost.blocked.concat(""):[""]},"Add channel")),t.createElement(E,{opened:c,onChange:()=>z(!c),title:"Blur specific channels"},e.ghost.blurChannels?.map((o,m)=>t.createElement(C,{placeholder:"Enter a channel/user id",value:o,onChange:u=>e.store.blurChannels[m]=u},"",t.createElement(s,{color:s.Colors.RED,onClick:()=>e.store.blurChannels=e.ghost.blurChannels.filter((u,f)=>f!==m)},"Remove"))),t.createElement(s,{onClick:()=>e.store.blurChannels=e.ghost.blurChannels?e.ghost.blurChannels.concat(""):[""]},"Add channel")))};const B=[];let N;const M=a.webpack.findByDisplayName("ChannelItem",!1),{getChannel:O}=a.webpack.findByProps("getChannel","getDMFromUserId");function h({channelId:e}){const n=O(e);this.ghost.blocked?.includes(e)||this.ghost.blocked?.includes(n.recipients[0])||(n.nsfw||n.type===1&&this.ghost.dm||n.type===3&&this.ghost.gc||this.ghost.blurChannels?.includes(n.id)||this.ghost.blurChannels?.includes(n.recipients[0])?b():document.body.classList.remove("blur"))}var V=({persist:e})=>(h=h.bind(e),b=b.bind(e),{onLoad(){N=I(),B.push(p.after("default",M,([{channel:n}],r)=>{!n.nsfw||e.ghost.notags||r.props.children.props.children[1].props.children[1].props.children.push(d.React.createElement("div",{className:"nsfw-badge"},d.React.createElement("div",{className:"nsfw-text"},"NSFW")))})),d.FluxDispatcher.subscribe("CHANNEL_SELECT",h)},onUnload(){d.FluxDispatcher.unsubscribe("CHANNEL_SELECT",h),N?.(),B.forEach(n=>n())},settings:d.React.createElement(_,{persist:e})});function b(){const e=this.ghost.blur||10,n=this.ghost.timing||1,r=document.body;r.style.setProperty("--blur-effect",`blur(${e}px)`),r.style.setProperty("--blur-timing",`${n}s`),r.classList.add("blur")}return V})(cumcord.patcher,cumcord.modules,cumcord.modules.common,cumcord.modules.common.React,cumcord.utils);
