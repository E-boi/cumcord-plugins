(function(R,n,l,h,T,d){"use strict";const m=d.webpack.findByProps("TooltipContainer").TooltipContainer,q=d.webpack.findByDisplayName("Arrow"),W=d.webpack.findByDisplayName("Clickable"),D=d.webpack.findByProps("ModalRoot"),L=d.webpack.findByDisplayName("Pin"),Z=d.webpack.findByDisplayName("FormTitle"),x=d.webpack.find(e=>e.DropdownSizes),J=d.webpack.findByDisplayName("ListSectionItem"),N=d.webpack.findByProps("openModalLazy");let S;const Q=e=>S=N.openModal(t=>(e.props={...e.props,...t},e)),Y=()=>N.closeModal(S),{default:K,MenuSeparator:X,MenuItem:ee,MenuCheckboxItem:te}=l.findByProps("MenuGroup"),{closeContextMenu:ne}=l.findByProps("openContextMenu");function _(e){switch(e.id=`cc-pd-${e.id}`,e.type){case"item":return n.React.createElement(ee,{...e},e.items?.()?.map(_));case"separator":return n.React.createElement(X,null);case"checkbox":return n.React.createElement(te,{...e});default:return null}}var ie=e=>(e.items=e.items.map(_),e.rawItems?[...e.items]:n.React.createElement(K,{onClose:()=>ne()},e.items));const A={dividerDefault:d.webpack.findByProps("dividerDefault").dividerDefault,divider:d.webpack.find(e=>e.divider?.includes("divider-_")).divider};var se=({className:e})=>n.React.createElement("div",{className:`${A.divider} ${A.dividerDefault} ${e}`});const ae=d.webpack.findByDisplayName("FormItem"),re=d.webpack.findByDisplayName("FormText"),f={...d.webpack.findByProps("marginBottom20"),...d.webpack.findByProps("formText"),...d.webpack.findByDisplayName("Flex")};var le=e=>n.React.createElement(ae,{title:e.title,required:e.required,className:`${f.Direction.VERTICAL} ${f.Justify.START} ${f.Align.STRETCH} ${f.Wrap.NO_WRAP} ${f.marginBottom20}`},e.children,e.note&&n.React.createElement(re,{className:`${f.description} ${f.marginTop8}`},e.note),n.React.createElement(se,{className:[f.marginTop20].join(" ")}));const F=d.webpack.findByDisplayName("TextInput");var w=e=>{Array.isArray(e.children)||(e.children=[e.children]);const t=e.children;return delete e.children,n.React.createElement(le,{title:t[0],required:e.required,note:e.note},t[1]?n.React.createElement("div",{className:"cc-pp-setting-input"},n.React.createElement(F,{...e}),t[1]):n.React.createElement(F,{...e}))},ce=({transitionState:e,dmId:t,settings:i})=>{const[s,a]=n.React.useState("");return n.React.createElement(D.ModalRoot,{transitionState:e},n.React.createElement(D.ModalHeader,null,n.React.createElement(Z,{tag:"h3"},"New Catgory")),n.React.createElement(D.ModalContent,null,n.React.createElement(w,{placeholder:"Category name",value:s,onChange:a},"New Category:")),n.React.createElement(D.ModalFooter,null,n.React.createElement(x,{disabled:!s,onClick:()=>{const c=i.get("categories",[]);c.push({name:s,dms:[t],pos:c.length,collapsed:!1}),i.set("categories",c),Y(),C()}},"Save")))};const{scroller:de}=l.findByProps("privateChannelsHeaderContainer");function C(){const e=document.getElementsByClassName(de)[0];!e||(e.dispatchEvent(new Event("focusin")),setTimeout(()=>{e.dispatchEvent(new Event("focusout"))},10))}function v(e,t,i){let s=[];const a=t.get("categories",[]).find(r=>r.dms.includes(e.id)),c=t.get("guildlist",[]).includes(e.id);if(a?s.push({type:"item",id:"remove-from-category",color:"colorDanger",label:`Remove from ${a.name}`,action(){a.dms=a.dms.filter(r=>r!==e.id),t.set(`categories[${a.pos}]`,a),C()}}):s.push({type:"item",id:"catgory-submenu",label:"Pin to Channel List",items(){const r=[{type:"item",id:"create-new-catgory",color:"colorBrand",label:"Add to new catgory",action(){Q(n.React.createElement(ce,{dmId:e.id,settings:t}))}},{type:"separator"}];return t.get("categories",[]).forEach(o=>r.push({type:"item",id:`add-to-category-${o.name}`,label:o.name,action(){o.dms.push(e.id),t.set(`categories[${o.pos}]`,o),C()}})),[...r]}}),c?s.push({type:"item",id:"remove-from-list",label:"Unpin from Server List",color:"colorDanger",action:()=>{const r=t.get("guildlist",[]).filter(o=>o!==e.id);t.set("guildlist",r),n.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_REMOVE"})}}):s.push({type:"item",id:"add-to-list",label:"Pin to Server List",action:()=>{const r=t.get("guildlist",[]);r.push(e.id),t.set("guildlist",r),n.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_ADD"})}}),i){const r=s;s=[{type:"item",label:"PinDMs",id:"submenu",items:()=>[...r]}]}return ie({items:s,rawItems:i})}const{GroupDM:oe,DirectMessage:ue}=l.findByProps("DirectMessage"),{getChannel:pe}=l.findByProps("getChannel","hasChannel");var U=({channelId:e,selected:t})=>{const i=pe(e);return i?i.type===3?n.React.createElement(oe,{channel:i,selected:t,tabIndex:-1}):n.React.createElement(ue,{channel:i,selected:t,tabIndex:-1}):null};const P={...l.findByProps("privateChannelsHeaderContainer"),...l.findByProps("containerDefault","name")};var fe=({category:e,settings:t})=>{const[i,s]=n.React.useState(e.collapsed);return e.dms.length?n.React.createElement(W,{tabIndex:-1,className:[P.clickable,"cc-pd-header"].join(" "),onClick:()=>{e.collapsed=!i,t.set(`categories[${e.pos}]`,e),C(),s(!i)}},n.React.createElement(J,{className:P.privateChannelsHeaderContainer},n.React.createElement("span",{className:P.headerText},e.name),n.React.createElement(q,{className:"cc-pd-arrow",direction:i?"LEFT":"DOWN"}))):null};const{default:he}=l.findByProps("DirectMessage"),ye=l.findByDisplayName("ConnectedPrivateChannelsList",!1),{openContextMenu:ge}=l.findByProps("openContextMenu"),{lastMessageId:j}=l.findByProps("lastMessageId");function Ce(){const e=this;this.injections.push(h.after("render",he.prototype,function(t,i){const s=i.props.children({role:"listitem"});return i.props.children=()=>{const a=n.React.createElement(m,{text:"Pin",position:"top"},n.React.createElement(L,{className:"cc-pd-pin",onClick:c=>{c.preventDefault();const r=v(this.props.channel,e.settings);ge(c,()=>r)},icon:L}));return s.props.children.props.children.splice(1,0,a),s},i})),this.injections.push(h.after("default",ye,(t,i)=>{const s=[],a=T.findInReactTree(i,r=>r?.selectedChannelId),c=this.settings.get("categories",[]);return c.forEach(r=>s.push(...r.dms)),a.privateChannelIds=a.privateChannelIds.filter(r=>!s.includes(r)),a.children=[...a.children],c.forEach(r=>{const o=n.React.createElement(fe,{category:r,settings:this.settings});if(a.children.push(o),r.collapsed){if(r.dms.includes(a.selectedChannelId)){const u=r.dms.find(p=>p===a.selectedChannelId);if(!u)return;a.children.push(n.React.createElement(U,{channelId:u,selected:!0}))}}else{const u=r.dms.sort((p,I)=>j(I)-j(p)).map(p=>n.React.createElement(U,{channelId:p,selected:a.selectedChannelId===p}));a.children.push(...u)}}),i}))}const{default:Ee}=l.findByProps("DirectMessage"),{getUser:De}=l.findByProps("getUser","findByTag"),{isMobileOnline:xe,getStatus:k,getState:Me}=l.findByProps("isMobileOnline"),{getChannel:Re}=l.findByProps("getDMFromUserId"),{listItemTooltip:ve}=l.findByProps("listItemTooltip"),{openContextMenu:Pe}=l.findByProps("openContextMenu"),{transitionTo:be}=l.findByProps("transitionTo"),{getMentionCount:G}=l.findByProps("getMentionCount"),Ie=l.findByDisplayName("AnimatedHalfPill");var Be=({settings:e})=>{const[t,i]=n.React.useState(e.get("guildlist",[]));return n.React.useEffect(()=>{const s=({removeAll:a})=>i(a?[]:[...e.get("guildlist",[])]);return n.FluxDispatcher.subscribe("PDM_GUILDLIST_ADD",s),n.FluxDispatcher.subscribe("PDM_GUILDLIST_REMOVE",s),()=>{n.FluxDispatcher.unsubscribe("PDM_GUILDLIST_ADD",s),n.FluxDispatcher.unsubscribe("PDM_GUILDLIST_REMOVE",s)}}),t.map(s=>n.React.createElement(Te,{channelId:s,settings:e}))};function Te({channelId:e,settings:t}){const[i,s]=n.React.useState(!1),[a,c]=n.React.useState(!1),[r,o]=n.React.useState(!!G(e)),u=Re(e);if(!u)return null;const p=De(u.recipients[0]),[I,je]=n.React.useState(k(p?.id)),B=Ee.prototype.renderAvatar.call({props:{user:p,channel:u,status:I,isMobile:xe.bind({getState:()=>Me()})(p?.id)}});return B.props.src=B.props.src.replace("size=32","size=64"),n.React.useEffect(()=>{const M=g=>g.user?.id===p?.id&&je(k(g.user.id)),z=g=>{g.channelId===u.id?c(!0):c(!1)},V=g=>g.id===e&&o(!!G(e));return n.FluxDispatcher.subscribe("PRESENCE_UPDATE",M),n.FluxDispatcher.subscribe("PDM_UPDATE",V),n.FluxDispatcher.subscribe("CHANNEL_SELECT",z),()=>{n.FluxDispatcher.unsubscribe("PRESENCE_UPDATE",M),n.FluxDispatcher.unsubscribe("CHANNEL_SELECT",z),n.FluxDispatcher.unsubscribe("PDM_UPDATE",V)}}),n.React.createElement(m,{text:u.type===3?u.name:p.username,position:"left","aria-label":!1,tooltipClassName:ve},n.React.createElement("div",{onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onContextMenu:M=>{Pe(M,()=>v(u,t))},onClick:()=>be(n.constants.Routes.CHANNEL("@me",u.id)),className:"cc-pd-guildpins"},n.React.createElement(Ie,{className:"pill-L_aLMQ",unread:r,selected:a,hovered:i}),B))}const me=l.findByProps("HomeButton"),Le=l.findByDisplayName("TransitionGroup",!1);function Ne(){this.injections.push(h.after("HomeButton",me,(e,t)=>(Array.isArray(t)||(t=[t]),this.settings.get("guildlist",[]).includes(t[0].props.selectedChannelId)&&(t[0].props.selected=!1),t.push(n.React.createElement(Be,{settings:this.settings})),t))),this.injections.push(h.after("render",Le.default.prototype,(e,t)=>(t.props.children.length&&t.props.children.forEach((i,s)=>{this.settings.get("guildlist",[]).includes(i.key.replace(".$",""))&&(t.props.children.splice(s,1),n.FluxDispatcher.dirtyDispatch({type:"PDM_UPDATE",id:i.key.replace(".$","")}))}),t)))}const Se=["DMUserContextMenu","GroupDMUserContextMenu","GuildChannelUserContextMenu","GroupDMContextMenu"],{getDMFromUserId:H,getChannel:O}=l.findByProps("getDMFromUserId");async function b(e,t){const i=l.findByDisplayName(e,!1);if(i)t(i);else{const s=l.findByProps("openContextMenuLazy");this.injections.unshift(h.before("openContextMenuLazy",s,a=>{const c=a[1];return a[1]=async()=>{const r=await c(a[0]);return o=>{const u=r(o);return u?.type?.displayName===e&&t&&(this.injections[0](),t(l.findByDisplayName(e,!1)),t=!1),u}},a}))}}function _e(){b=b.bind(this),Se.forEach(e=>{b(e,t=>{this.injections.push(h.after("default",t,([i],s)=>{const a=T.findInReactTree(s,r=>Array.isArray(r)&&r.find(o=>o?.props?.id==="user-profile"||o?.props?.id==="remove-icon"));if(!a)return s;if(!!(i.channel||O(H(i.user.id))))return a.push(v(i.channel||O(H(i.user.id)),this.settings,!0)),s}))})})}var y={Categories:Ce,GuildList:Ne,ContextMenus:_e},Ae=()=>cumcord.patcher.injectCSS(".channel-1Shao0>.interactive-1vLZ_I{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}.cc-pd-pin{width:15px;min-width:15px;min-height:15px;height:15px;display:none;opacity:.4}.channel-1Shao0>.interactive-1vLZ_I:hover .cc-pd-pin{display:block;opacity:.8}.cc-pd-guildpins{display:flex;justify-content:center;position:relative;cursor:pointer}.cc-pd-guildpins .wrapper-1VLyxH{margin-bottom:8px;height:48px!important;width:48px!important}.cc-pd-header{display:flex;justify-content:center;align-items:center}.cc-pd-arrow{height:18px;width:18px}.cc-pd-arrow>polygon{fill:var(--channels-default)}.cc-pd-header:hover .cc-pd-arrow polygon{fill:var(--interactive-hover)}.cc-pp-setting-input{display:flex}.cc-pp-setting-input .inputWrapper-1YNMmM{width:-webkit-fill-available}.cc-pp-setting-input button{margin-left:9px;min-width:130px;min-height:40px}");function Fe({category:e,settings:t,onDelete:i}){const[s,a]=n.React.useState(e.name);return console.log(s),n.React.createElement(w,{value:s,onChange:c=>{e.name=c,t.set(`categories[${e.pos}]`,e),a(c)}},s,n.React.createElement(x,{color:x.Colors.RED,onClick:()=>i?.(e.pos)},"Delete Category"))}var we=({settings:e})=>{const[t,i]=n.React.useState(e.get("categories",[]));return t?n.React.createElement("div",null,t.map(s=>n.React.createElement(Fe,{category:s,settings:e,onDelete:a=>{t.splice(a,1),t.forEach((c,r)=>c.pos=r),e.set("categories",t),i(null),setTimeout(()=>i(t))}})),n.React.createElement(x,{onClick:()=>{t.push({name:"New Category",dms:[],pos:t.length,collapsed:!1}),e.set("categories",t),i(null),setTimeout(()=>i(t))}},"Add a category")):null};const E={},$={get(e,t){return window._.get(R.persist.ghost,e)??t},set(e,t){R.persist.store=window._.set(R.persist.ghost,e,t)}};var Ue=()=>(Object.keys(y).forEach(e=>{E[e]=[],y[e]=y[e].bind({injections:E[e],settings:$})}),{onLoad(){Object.keys(y).forEach(e=>y[e]()),E.css=[Ae()]},onUnload(){Object.keys(y).forEach(e=>{E[e].forEach(t=>t?.())}),E.css[0]?.(),C(),n.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_REMOVE",removeAll:!0})},settings:n.React.createElement(we,{settings:$})});return Ue})(cumcord.pluginData,cumcord.modules.common,cumcord.modules.webpack,cumcord.patcher,cumcord.utils,cumcord.modules);
