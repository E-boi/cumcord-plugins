(function(c,a,m,N,p,l,V){"use strict";function q(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var s=q(V);const T=p.webpack.findByProps("TooltipContainer").TooltipContainer,W=p.webpack.findByDisplayName("Arrow"),Z=p.webpack.findByDisplayName("Clickable"),x=p.webpack.findByProps("ModalRoot"),L=p.webpack.findByDisplayName("Pin"),J=p.webpack.findByDisplayName("FormTitle"),M=p.webpack.find(e=>e.DropdownSizes),Q=p.webpack.findByDisplayName("ListSectionItem"),S=p.webpack.findByProps("openModalLazy");let _;const Y=e=>_=S.openModal(t=>(e.props={...e.props,...t},e)),K=()=>S.closeModal(_),{default:X,MenuSeparator:ee,MenuItem:te,MenuCheckboxItem:ne}=a.findByProps("MenuGroup"),{closeContextMenu:se}=a.findByProps("openContextMenu");function A(e){switch(e.id=`cc-pd-${e.id}`,e.type){case"item":return s.createElement(te,{...e},e.items?.()?.map(A));case"separator":return s.createElement(ee,null);case"checkbox":return s.createElement(ne,{...e});default:return null}}var ie=e=>(e.items=e.items.map(A),e.rawItems?[...e.items]:s.createElement(X,{onClose:()=>se()},e.items));const R={dividerDefault:p.webpack.findByProps("dividerDefault").dividerDefault,divider:p.webpack.find(e=>e.divider?.includes("divider-_")).divider};var re=({className:e})=>s.createElement("div",{className:`${R.divider} ${R.dividerDefault} ${e}`});const oe=p.webpack.findByDisplayName("FormItem"),ae=p.webpack.findByDisplayName("FormText"),h={...p.webpack.findByProps("marginBottom20"),...p.webpack.findByProps("formText"),...p.webpack.findByDisplayName("Flex")};var ce=e=>s.createElement(oe,{title:e.title,required:e.required,className:`${h.Direction.VERTICAL} ${h.Justify.START} ${h.Align.STRETCH} ${h.Wrap.NO_WRAP} ${h.marginBottom20}`},e.children,e.note&&s.createElement(ae,{className:`${h.description} ${h.marginTop8}`},e.note),s.createElement(re,{className:[h.marginTop20].join(" ")}));const F=p.webpack.findByDisplayName("TextInput");var U=e=>{Array.isArray(e.children)||(e.children=[e.children]);const t=e.children;return delete e.children,s.createElement(ce,{title:t[0],required:e.required,note:e.note},t[1]?s.createElement("div",{className:"cc-pp-setting-input"},s.createElement(F,{...e}),t[1]):s.createElement(F,{...e}))},le=({transitionState:e,dmId:t})=>{const[n,i]=s.useState("");return s.createElement(x.ModalRoot,{transitionState:e},s.createElement(x.ModalHeader,null,s.createElement(J,{tag:"h3"},"New Catgory")),s.createElement(x.ModalContent,null,s.createElement(U,{placeholder:"Category name",value:n,onChange:i},"New Category:")),s.createElement(x.ModalFooter,null,s.createElement(M,{disabled:!n,onClick:()=>{const o=l.persist.ghost.categories??[];o.push({name:n,dms:[t],pos:o.length,collapsed:!1}),l.persist.store.categories=o,K(),C()}},"Save")))};const{scroller:de}=a.findByProps("privateChannelsHeaderContainer");function C(){const e=document.getElementsByClassName(de)[0];!e||(e.dispatchEvent(new Event("focusin")),setTimeout(()=>{e.dispatchEvent(new Event("focusout"))},10))}function v(e,t){let n=[];const i=(l.persist.ghost.categories??[]).find(r=>r.dms.includes(e.id)),o=(l.persist.ghost.guildlist??[]).includes(e.id);if(i?n.push({type:"item",id:"remove-from-category",color:"colorDanger",label:`Remove from ${i.name}`,action(){i.dms=i.dms.filter(r=>r!==e.id),l.persist.store.categories[i.pos]=i,C()}}):n.push({type:"item",id:"catgory-submenu",label:"Pin to Channel List",items(){const r=[{type:"item",id:"create-new-catgory",color:"colorBrand",label:"Add to new catgory",action(){Y(c.React.createElement(le,{dmId:e.id}))}},{type:"separator"}];return(l.persist.ghost.categories??[]).forEach(u=>r.push({type:"item",id:`add-to-category-${u.name}`,label:u.name,action(){u.dms.push(e.id),l.persist.store.categories[u.pos]=u,C()}})),[...r]}}),o?n.push({type:"item",id:"remove-from-list",label:"Unpin from Server List",color:"colorDanger",action:()=>{const r=(l.persist.ghost.guildlist??[]).filter(u=>u!==e.id);l.persist.store.guildlist=r,c.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_REMOVE"})}}):n.push({type:"item",id:"add-to-list",label:"Pin to Server List",action:()=>{const r=l.persist.ghost.guildlist??[];r.push(e.id),l.persist.store.guildlist=r,c.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_ADD"})}}),t){const r=n;n=[{type:"item",label:"PinDMs",id:"submenu",items:()=>[...r]}]}return ie({items:n,rawItems:t})}const{GroupDM:pe,DirectMessage:ue}=a.findByProps("DirectMessage"),{getChannel:fe}=a.findByProps("getChannel","hasChannel");var w=({channelId:e,selected:t})=>{const n=fe(e);return n?n.type===3?s.createElement(pe,{channel:n,selected:t,tabIndex:-1}):s.createElement(ue,{channel:n,selected:t,tabIndex:-1}):null};const b={...a.findByProps("privateChannelsHeaderContainer"),...a.findByProps("containerDefault","name")};var he=({category:e})=>{const[t,n]=s.useState(e.collapsed);return e.dms.length?s.createElement(Z,{tabIndex:-1,className:[b.clickable,"cc-pd-header"].join(" "),onClick:()=>{e.collapsed=!t,l.persist.store.categories[e.pos]=e,C(),n(!t)}},s.createElement(Q,{className:b.privateChannelsHeaderContainer},s.createElement("span",{className:b.headerText},e.name),s.createElement(W,{className:"cc-pd-arrow",direction:t?"LEFT":"DOWN"}))):null};const{default:me}=a.findByProps("DirectMessage"),ye=a.findByDisplayName("ConnectedPrivateChannelsList",!1),{openContextMenu:Ee}=a.findByProps("openContextMenu"),{lastMessageId:j}=a.findByProps("lastMessageId");function Ce(){this.injections.push(m.after("render",me.prototype,function(e,t){const n=t.props.children({role:"listitem"});return t.props.children=()=>{const i=c.React.createElement(T,{text:"Pin",position:"top"},c.React.createElement(L,{className:"cc-pd-pin",onClick:o=>{o.preventDefault();const r=v(this.props.channel);Ee(o,()=>r)},icon:L}));return n.props.children.props.children.splice(1,0,i),n},t})),this.injections.push(m.after("default",ye,(e,t)=>{const n=N.findInReactTree(t,r=>r?.privateChannelIds);if(!n)return t;const i=[],o=l.persist.ghost.categories??[];return o.forEach(r=>i.push(...r.dms)),n.privateChannelIds=n.privateChannelIds.filter(r=>!i.includes(r)),n.children=[...n.children],o.forEach(r=>{const u=c.React.createElement(he,{category:r});if(n.children.push(u),r.collapsed){if(r.dms.includes(n.selectedChannelId)){const d=r.dms.find(f=>f===n.selectedChannelId);if(!d)return;n.children.push(c.React.createElement(w,{channelId:d,selected:!0}))}}else{const d=r.dms.sort((f,I)=>j(I)-j(f)).map(f=>c.React.createElement(w,{channelId:f,selected:n.selectedChannelId===f}));n.children.push(...d)}}),t}))}const{default:ge}=a.findByProps("DirectMessage"),{getUser:xe}=a.findByProps("getUser","findByTag"),{isMobileOnline:Me,getStatus:O,getState:De}=a.findByProps("isMobileOnline"),{getChannel:ve}=a.findByProps("getDMFromUserId"),{listItemTooltip:be}=a.findByProps("listItemTooltip"),{openContextMenu:Pe}=a.findByProps("openContextMenu"),{transitionTo:Ie}=a.findByProps("transitionTo"),{getMentionCount:G}=a.findByProps("getMentionCount"),Be=a.findByDisplayName("AnimatedHalfPill");var Ne=()=>{const[e,t]=s.useState(l.persist.ghost.guildlist??[]);return s.useEffect(()=>{const n=l.persist.ghost.guildlist??[],i=({removeAll:o})=>t(o?[]:[...n]);return c.FluxDispatcher.subscribe("PDM_GUILDLIST_ADD",i),c.FluxDispatcher.subscribe("PDM_GUILDLIST_REMOVE",i),()=>{c.FluxDispatcher.unsubscribe("PDM_GUILDLIST_ADD",i),c.FluxDispatcher.unsubscribe("PDM_GUILDLIST_REMOVE",i)}}),e.map(n=>s.createElement(Te,{channelId:n}))};function Te({channelId:e}){const[t,n]=s.useState(!1),[i,o]=s.useState(!1),[r,u]=s.useState(!!G(e)),d=ve(e);if(!d)return null;const f=xe(d.recipients[0]),[I,Oe]=s.useState(O(f?.id)),B=ge.prototype.renderAvatar.call({props:{user:f,channel:d,status:I,isMobile:Me.bind({getState:()=>De()})(f?.id)}});return B.props.src=B.props.src.replace("size=32","size=64"),s.useEffect(()=>{const D=E=>E.user?.id===f?.id&&Oe(O(E.user.id)),z=E=>{E.channelId===d.id?o(!0):o(!1)},$=E=>E.id===e&&u(!!G(e));return c.FluxDispatcher.subscribe("PRESENCE_UPDATE",D),c.FluxDispatcher.subscribe("PDM_UPDATE",$),c.FluxDispatcher.subscribe("CHANNEL_SELECT",z),()=>{c.FluxDispatcher.unsubscribe("PRESENCE_UPDATE",D),c.FluxDispatcher.unsubscribe("CHANNEL_SELECT",z),c.FluxDispatcher.unsubscribe("PDM_UPDATE",$)}}),s.createElement(T,{text:d.type===3?d.name:f.username,position:"left","aria-label":!1,tooltipClassName:be},s.createElement("div",{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),onContextMenu:D=>{Pe(D,()=>v(d))},onClick:()=>Ie(c.constants.Routes.CHANNEL("@me",d.id)),className:"cc-pd-guildpins"},s.createElement(Be,{className:"pill-L_aLMQ",unread:r,selected:i,hovered:t}),B))}const Le=a.findByProps("HomeButton"),Se=a.findByDisplayName("TransitionGroup",!1);function _e(){this.injections.push(m.after("HomeButton",Le,(e,t)=>(Array.isArray(t)||(t=[t]),(l.persist.ghost.guildlist??[]).includes(t[0].props.selectedChannelId)&&(t[0].props.selected=!1),t.push(c.React.createElement(Ne)),t))),this.injections.push(m.after("render",Se.default.prototype,(e,t)=>(t.props.children.length&&t.props.children.forEach((n,i)=>{(l.persist.ghost.guildlist??[]).includes(n.key.replace(".$",""))&&(t.props.children.splice(i,1),c.FluxDispatcher.dirtyDispatch({type:"PDM_UPDATE",id:n.key.replace(".$","")}))}),t)))}const Ae=["DMUserContextMenu","GroupDMUserContextMenu","GuildChannelUserContextMenu","GroupDMContextMenu"],{getDMFromUserId:k,getChannel:H}=a.findByProps("getDMFromUserId");async function P(e,t){const n=a.findByDisplayName(e,!1);if(n)t(n);else{const i=a.findByProps("openContextMenuLazy");this.injections.unshift(m.before("openContextMenuLazy",i,o=>{const r=o[1];return o[1]=async()=>{const u=await r(o[0]);return d=>{const f=u(d);return f?.type?.displayName===e&&t&&(this.injections[0](),t(a.findByDisplayName(e,!1)),t=!1),f}},o}))}}function Re(){P=P.bind(this),Ae.forEach(e=>{P(e,t=>{this.injections.push(m.after("default",t,([n],i)=>{const o=N.findInReactTree(i,u=>Array.isArray(u)&&u.find(d=>d?.props?.id==="user-profile"||d?.props?.id==="remove-icon"));if(!o)return i;if(!!(n.channel||H(k(n.user.id))))return o.push(v(n.channel||H(k(n.user.id)),this.settings)),i}))})})}var y={Categories:Ce,GuildList:_e,ContextMenus:Re},Fe=()=>m.injectCSS(".channel-1Shao0>.interactive-1vLZ_I{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}.cc-pd-pin{width:15px;min-width:15px;min-height:15px;height:15px;display:none;opacity:.4}.channel-1Shao0>.interactive-1vLZ_I:hover .cc-pd-pin{display:block;opacity:.8}.cc-pd-guildpins{display:flex;justify-content:center;position:relative;cursor:pointer}.cc-pd-guildpins .wrapper-1VLyxH{margin-bottom:8px;height:48px!important;width:48px!important}.cc-pd-header{display:flex;justify-content:center;align-items:center}.cc-pd-arrow{height:18px;width:18px}.cc-pd-arrow>polygon{fill:var(--channels-default)}.cc-pd-header:hover .cc-pd-arrow polygon{fill:var(--interactive-hover)}.cc-pp-setting-input{display:flex}.cc-pp-setting-input .inputWrapper-1YNMmM{width:-webkit-fill-available}.cc-pp-setting-input button{margin-left:9px;min-width:130px;min-height:40px}");function Ue({category:e,onDelete:t}){const[n,i]=s.useState(e.name);return s.createElement(U,{value:n,onChange:o=>{e.name=o,l.persist.store.categories[e.pos]=e,i(o)}},n,s.createElement(M,{color:M.Colors.RED,onClick:()=>t?.(e.pos)},"Delete Category"))}var we=()=>{const[e,t]=s.useState(l.persist.ghost.categories??[]);return e?s.createElement("div",null,e.map(n=>s.createElement(Ue,{category:n,onDelete:i=>{e.splice(i,1),e.forEach((o,r)=>o.pos=r),l.persist.store.categories=e,t(null),setTimeout(()=>t(e))}})),s.createElement(M,{onClick:()=>{e.push({name:"New Category",dms:[],pos:e.length,collapsed:!1}),l.persist.store.categories=e,t(null),setTimeout(()=>t(e))}},"Add a category")):null};const g={};var je=()=>(Object.keys(y).forEach(e=>{g[e]=[],y[e]=y[e].bind({injections:g[e]})}),{onLoad(){Object.keys(y).forEach(e=>y[e]()),g.css=[Fe()]},onUnload(){Object.keys(y).forEach(e=>{g[e].forEach(t=>t?.())}),g.css[0]?.(),C(),c.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_REMOVE",removeAll:!0})},settings:c.React.createElement(we)});return je})(cumcord.modules.common,cumcord.modules.webpack,cumcord.patcher,cumcord.utils,cumcord.modules,cumcord.pluginData,cumcord.modules.common.React);
