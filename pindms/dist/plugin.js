(function(c,o,m,N,d,l,V){"use strict";function q(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),t.default=e,Object.freeze(t)}var r=q(V);const $=d.webpack.findByProps("TooltipContainer").TooltipContainer,W=d.webpack.findByDisplayName("Arrow"),Z=d.webpack.findByDisplayName("Clickable"),x=d.webpack.findByProps("ModalRoot"),T=d.webpack.findByDisplayName("Pin"),J=d.webpack.findByDisplayName("FormTitle"),D=d.webpack.find(e=>e.DropdownSizes),Q=d.webpack.findByDisplayName("ListSectionItem"),S=d.webpack.findByProps("openModalLazy");let L;const Y=e=>L=S.openModal(t=>(e.props={...e.props,...t},e)),K=()=>S.closeModal(L),{default:X,MenuSeparator:ee,MenuItem:te,MenuCheckboxItem:ne}=o.findByProps("MenuGroup"),{closeContextMenu:re}=o.findByProps("openContextMenu");function _(e){switch(e.id=`cc-pd-${e.id}`,e.type){case"item":return r.createElement(te,{...e},e.items?.()?.map(_));case"separator":return r.createElement(ee,null);case"checkbox":return r.createElement(ne,{...e});default:return null}}var se=e=>(e.items=e.items.map(_),e.rawItems?[...e.items]:r.createElement(X,{onClose:()=>re()},e.items));const A={dividerDefault:d.webpack.findByProps("dividerDefault").dividerDefault,divider:d.webpack.find(e=>e.divider?.includes("divider-_")).divider};var ie=({className:e})=>r.createElement("div",{className:`${A.divider} ${A.dividerDefault} ${e}`});const ae=d.webpack.findByDisplayName("FormItem"),oe=d.webpack.findByDisplayName("FormText"),f={...d.webpack.findByProps("marginBottom20"),...d.webpack.findByProps("formText"),...d.webpack.findByDisplayName("Flex")};var ce=e=>r.createElement(ae,{title:e.title,required:e.required,className:`${f.Direction.VERTICAL} ${f.Justify.START} ${f.Align.STRETCH} ${f.Wrap.NO_WRAP} ${f.marginBottom20}`},e.children,e.note&&r.createElement(oe,{className:`${f.description} ${f.marginTop8}`},e.note),r.createElement(ie,{className:[f.marginTop20].join(" ")}));const R=d.webpack.findByDisplayName("TextInput");var w=e=>{Array.isArray(e.children)||(e.children=[e.children]);const t=e.children;return delete e.children,r.createElement(ce,{title:t[0],required:e.required,note:e.note},t[1]?r.createElement("div",{className:"cc-pp-setting-input"},r.createElement(R,{...e}),t[1]):r.createElement(R,{...e}))},le=({transitionState:e,dmId:t})=>{const[n,i]=r.useState("");return r.createElement(x.ModalRoot,{transitionState:e},r.createElement(x.ModalHeader,null,r.createElement(J,{tag:"h3"},"New Catgory")),r.createElement(x.ModalContent,null,r.createElement(w,{placeholder:"Category name",value:n,onChange:i},"New Category:")),r.createElement(x.ModalFooter,null,r.createElement(D,{disabled:!n,onClick:()=>{const a=l.persist.ghost.categories??[];a.push({name:n,dms:[t],pos:a.length,collapsed:!1}),l.persist.store.categories=a,K(),E()}},"Save")))};const{scroller:de}=o.findByProps("privateChannelsHeaderContainer");function E(){const e=document.getElementsByClassName(de)[0];!e||(e.dispatchEvent(new Event("focusin")),setTimeout(()=>{e.dispatchEvent(new Event("focusout"))},10))}function M(e,t){let n=[];const i=(l.persist.ghost.categories??[]).find(s=>s.dms.includes(e.id)),a=(l.persist.ghost.guildlist??[]).includes(e.id);if(i?n.push({type:"item",id:"remove-from-category",color:"colorDanger",label:`Remove from ${i.name}`,action(){i.dms=i.dms.filter(s=>s!==e.id),l.persist.store.categories[i.pos]=i,E()}}):n.push({type:"item",id:"catgory-submenu",label:"Pin to Channel List",items(){const s=[{type:"item",id:"create-new-catgory",color:"colorBrand",label:"Add to new catgory",action(){Y(c.React.createElement(le,{dmId:e.id}))}},{type:"separator"}];return(l.persist.ghost.categories??[]).forEach(p=>s.push({type:"item",id:`add-to-category-${p.name}`,label:p.name,action(){p.dms.push(e.id),l.persist.store.categories[p.pos]=p,E()}})),[...s]}}),a?n.push({type:"item",id:"remove-from-list",label:"Unpin from Server List",color:"colorDanger",action:()=>{const s=(l.persist.ghost.guildlist??[]).filter(p=>p!==e.id);l.persist.store.guildlist=s,c.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_REMOVE"})}}):n.push({type:"item",id:"add-to-list",label:"Pin to Server List",action:()=>{const s=l.persist.ghost.guildlist??[];s.push(e.id),l.persist.store.guildlist=s,c.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_ADD"})}}),t){const s=n;n=[{type:"item",label:"PinDMs",id:"submenu",items:()=>[...s]}]}return se({items:n,rawItems:t})}const{GroupDM:pe,DirectMessage:ue}=o.findByProps("DirectMessage"),{getChannel:he}=o.findByProps("getChannel","hasChannel");var F=({channelId:e,selected:t})=>{const n=he(e);return n?n.type===3?r.createElement(pe,{channel:n,selected:t,tabIndex:-1}):r.createElement(ue,{channel:n,selected:t,tabIndex:-1}):null};const b={...o.findByProps("privateChannelsHeaderContainer"),...o.findByProps("containerDefault","name")};var fe=({category:e})=>{const[t,n]=r.useState(e.collapsed);return e.dms.length?r.createElement(Z,{tabIndex:-1,className:[b.clickable,"cc-pd-header"].join(" "),onClick:()=>{e.collapsed=!t,l.persist.store.categories[e.pos]=e,E(),n(!t)}},r.createElement(Q,{className:b.privateChannelsHeaderContainer},r.createElement("span",{className:b.headerText},e.name),r.createElement(W,{className:"cc-pd-arrow",direction:t?"LEFT":"DOWN"}))):null};const{default:me}=o.findByProps("DirectMessage"),ye=o.findByDisplayName("ConnectedPrivateChannelsList",!1),{openContextMenu:ge}=o.findByProps("openContextMenu"),{lastMessageId:U}=o.findByProps("lastMessageId");function Ee(){this.injections.push(m.after("render",me.prototype,function(e,t){const n=t.props.children({role:"listitem"});return t.props.children=()=>{const i=c.React.createElement($,{text:"Pin",position:"top"},c.React.createElement(T,{className:"cc-pd-pin",onClick:a=>{a.preventDefault();const s=M(this.props.channel);ge(a,()=>s)},icon:T}));return n.props.children.props.children.splice(1,0,i),n},t})),this.injections.push(m.after("default",ye,(e,t)=>{const n=N.findInReactTree(t,s=>s?.privateChannelIds);if(!n)return t;const i=[],a=l.persist.ghost.categories??[];return a.forEach(s=>i.push(...s.dms)),n.privateChannelIds=n.privateChannelIds.filter(s=>!i.includes(s)),n.children=[...n.children],a.forEach(s=>{const p=c.React.createElement(fe,{category:s});if(n.children.push(p),s.collapsed){if(s.dms.includes(n.selectedChannelId)){const u=s.dms.find(h=>h===n.selectedChannelId);if(!u)return;n.children.push(c.React.createElement(F,{channelId:u,selected:!0}))}}else{const u=s.dms.sort((h,I)=>U(I)-U(h)).map(h=>c.React.createElement(F,{channelId:h,selected:n.selectedChannelId===h}));n.children.push(...u)}}),t}))}const{default:Ce}=o.findByProps("DirectMessage"),{getUser:xe}=o.findByProps("getUser","findByTag"),{isMobileOnline:De,getStatus:j,getState:ve}=o.findByProps("isMobileOnline"),{getChannel:Me}=o.findByProps("getDMFromUserId"),{listItemTooltip:be}=o.findByProps("listItemTooltip"),{openContextMenu:Pe}=o.findByProps("openContextMenu"),{transitionTo:Ie}=o.findByProps("transitionTo"),{getMentionCount:O}=o.findByProps("getMentionCount"),Be=o.findByDisplayName("AnimatedHalfPill");var Ne=()=>{const[e,t]=r.useState(l.persist.ghost.guildlist??[]);return r.useEffect(()=>{const n=l.persist.ghost.guildlist??[],i=({removeAll:a})=>t(a?[]:[...n]);return c.FluxDispatcher.subscribe("PDM_GUILDLIST_ADD",i),c.FluxDispatcher.subscribe("PDM_GUILDLIST_REMOVE",i),()=>{c.FluxDispatcher.unsubscribe("PDM_GUILDLIST_ADD",i),c.FluxDispatcher.unsubscribe("PDM_GUILDLIST_REMOVE",i)}}),e.map(n=>r.createElement($e,{channelId:n}))};function $e({channelId:e}){const[t,n]=r.useState(!1),[i,a]=r.useState(!1),[s,p]=r.useState(!!O(e)),u=Me(e);if(!u)return null;const h=xe(u.recipients[0]),[I,je]=r.useState(j(h?.id)),B=Ce.prototype.renderAvatar.call({props:{user:h,channel:u,status:I,isMobile:De.bind({getState:()=>ve()})(h?.id)}});return B.props.src=B.props.src.replace("size=32","size=64"),r.useEffect(()=>{const v=g=>g.user?.id===h?.id&&je(j(g.user.id)),H=g=>{g.channelId===u.id?a(!0):a(!1)},z=g=>g.id===e&&p(!!O(e));return c.FluxDispatcher.subscribe("PRESENCE_UPDATE",v),c.FluxDispatcher.subscribe("PDM_UPDATE",z),c.FluxDispatcher.subscribe("CHANNEL_SELECT",H),()=>{c.FluxDispatcher.unsubscribe("PRESENCE_UPDATE",v),c.FluxDispatcher.unsubscribe("CHANNEL_SELECT",H),c.FluxDispatcher.unsubscribe("PDM_UPDATE",z)}}),r.createElement($,{text:u.type===3?u.name:h.username,position:"left","aria-label":!1,tooltipClassName:be},r.createElement("div",{onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),onContextMenu:v=>{Pe(v,()=>M(u))},onClick:()=>Ie(c.constants.Routes.CHANNEL("@me",u.id)),className:"cc-pd-guildpins"},r.createElement(Be,{className:"pill-L_aLMQ",unread:s,selected:i,hovered:t}),B))}const Te=o.findByProps("HomeButton"),Se=o.findByDisplayName("TransitionGroup",!1);function Le(){this.injections.push(m.after("HomeButton",Te,(e,t)=>(Array.isArray(t)||(t=[t]),(l.persist.ghost.guildlist??[]).includes(t[0].props.selectedChannelId)&&(t[0].props.selected=!1),t.push(c.React.createElement(Ne)),t))),this.injections.push(m.after("render",Se.default.prototype,(e,t)=>(t.props.children.length&&t.props.children.forEach((n,i)=>{(l.persist.ghost.guildlist??[]).includes(n.key.replace(".$",""))&&(t.props.children.splice(i,1),c.FluxDispatcher.dirtyDispatch({type:"PDM_UPDATE",id:n.key.replace(".$","")}))}),t)))}const _e=["DMUserContextMenu","GroupDMUserContextMenu","GuildChannelUserContextMenu","GroupDMContextMenu"],{getDMFromUserId:k,getChannel:G}=o.findByProps("getDMFromUserId");async function P(e,t){const n=o.findByDisplayName(e,!1);if(n)t(n);else{const i=o.findByProps("openContextMenuLazy");this.injections.unshift(m.before("openContextMenuLazy",i,a=>{const s=a[1];return a[1]=async()=>{const p=await s(a[0]);return u=>{const h=p(u);return h?.type?.displayName===e&&t&&(this.injections[0](),t(o.findByDisplayName(e,!1)),t=!1),h}},a}))}}function Ae(){P=P.bind(this),_e.forEach(e=>{P(e,t=>{this.injections.push(m.after("default",t,([n],i)=>{const a=N.findInReactTree(i,s=>Array.isArray(s)&&s.find(p=>p?.props?.id==="user-profile"||p?.props?.id==="remove-icon"));if(!a)return i;if(n.channel||G(k(n.user.id)))return a.push(M(n.channel||G(k(n.user.id)),this.settings)),i}))})})}var y={Categories:Ee,GuildList:Le,ContextMenus:Ae},Re=()=>m.injectCSS(".channel-1Shao0>.interactive-1vLZ_I{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}.cc-pd-pin{width:15px;min-width:15px;min-height:15px;height:15px;display:none;opacity:.4}.channel-1Shao0>.interactive-1vLZ_I:hover .cc-pd-pin{display:block;opacity:.8}.cc-pd-guildpins{display:flex;justify-content:center;position:relative;cursor:pointer}.cc-pd-guildpins .wrapper-1VLyxH{margin-bottom:8px;height:48px!important;width:48px!important}.cc-pd-header{display:flex;justify-content:center;align-items:center}.cc-pd-arrow{height:18px;width:18px}.cc-pd-arrow>polygon{fill:var(--channels-default)}.cc-pd-header:hover .cc-pd-arrow polygon{fill:var(--interactive-hover)}.cc-pp-setting-input{display:flex}.cc-pp-setting-input .inputWrapper-1YNMmM{width:-webkit-fill-available}.cc-pp-setting-input button{margin-left:9px;min-width:130px;min-height:40px}");function we({category:e,onDelete:t}){const[n,i]=r.useState(e.name);return r.createElement(w,{value:n,onChange:a=>{e.name=a,l.persist.store.categories[e.pos]=e,i(a)}},n,r.createElement(D,{color:D.Colors.RED,onClick:()=>t?.(e.pos)},"Delete Category"))}var Fe=()=>{const[e,t]=r.useState(l.persist.ghost.categories??[]);return e?r.createElement("div",null,e.map(n=>r.createElement(we,{category:n,onDelete:i=>{e.splice(i,1),e.forEach((a,s)=>a.pos=s),l.persist.store.categories=e,t(null),setTimeout(()=>t(e))}})),r.createElement(D,{onClick:()=>{e.push({name:"New Category",dms:[],pos:e.length,collapsed:!1}),l.persist.store.categories=e,t(null),setTimeout(()=>t(e))}},"Add a category")):null};const C={};var Ue=()=>(Object.keys(y).forEach(e=>{C[e]=[],y[e]=y[e].bind({injections:C[e]})}),{onLoad(){Object.keys(y).forEach(e=>y[e]()),C.css=[Re()]},onUnload(){Object.keys(y).forEach(e=>{C[e].forEach(t=>t?.())}),C.css[0]?.(),E(),c.FluxDispatcher.dirtyDispatch({type:"PDM_GUILDLIST_REMOVE",removeAll:!0})},settings:c.React.createElement(Fe)});return Ue})(cumcord.modules.common,cumcord.modules.webpack,cumcord.patcher,cumcord.utils,cumcord.modules,cumcord.pluginData,cumcord.modules.common.React);
