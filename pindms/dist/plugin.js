(function(c,o,h,N,p,d,q){"use strict";function W(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){if(t!=="default"){var i=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,i.get?i:{enumerable:!0,get:function(){return e[t]}})}}),n.default=e,Object.freeze(n)}var s=W(q);const T=p.webpack.findByProps("TooltipContainer").TooltipContainer,Z=p.webpack.findByDisplayName("Arrow"),J=p.webpack.findByDisplayName("Clickable"),v=p.webpack.findByProps("ModalRoot"),L=p.webpack.findByDisplayName("Pin"),Q=p.webpack.findByDisplayName("FormTitle"),D=p.webpack.find(e=>e.DropdownSizes),Y=p.webpack.findByDisplayName("ListSectionItem"),S=p.webpack.findByProps("openModalLazy");let _;const K=e=>_=S.openModal(n=>(e.props={...e.props,...n},e)),X=()=>S.closeModal(_),{default:ee,MenuSeparator:te,MenuItem:ne,MenuCheckboxItem:se}=o.findByProps("MenuGroup"),{closeContextMenu:ie}=o.findByProps("openContextMenu");function A(e){switch(e.id=`cc-pd-${e.id}`,e.type){case"item":return s.createElement(ne,{...e},e.items?.()?.map(A));case"separator":return s.createElement(te,null);case"checkbox":return s.createElement(se,{...e});default:return null}}var re=e=>(e.items=e.items.map(A),e.rawItems?[...e.items]:s.createElement(ee,{onClose:()=>ie()},e.items));const R={dividerDefault:p.webpack.findByProps("dividerDefault").dividerDefault,divider:p.webpack.find(e=>e.divider?.includes("divider-_")).divider};var oe=({className:e})=>s.createElement("div",{className:`${R.divider} ${R.dividerDefault} ${e}`});const ae=p.webpack.findByDisplayName("FormItem"),ce=p.webpack.findByDisplayName("FormText"),m={...p.webpack.findByProps("marginBottom20"),...p.webpack.findByProps("formText"),...p.webpack.findByDisplayName("Flex")};var le=e=>s.createElement(ae,{title:e.title,required:e.required,className:`${m.Direction.VERTICAL} ${m.Justify.START} ${m.Align.STRETCH} ${m.Wrap.NO_WRAP} ${m.marginBottom20}`},e.children,e.note&&s.createElement(ce,{className:`${m.description} ${m.marginTop8}`},e.note),s.createElement(oe,{className:[m.marginTop20].join(" ")}));const F=p.webpack.findByDisplayName("TextInput");var w=e=>{Array.isArray(e.children)||(e.children=[e.children]);const n=e.children;return delete e.children,s.createElement(le,{title:n[0],required:e.required,note:e.note},n[1]?s.createElement("div",{className:"cc-pp-setting-input"},s.createElement(F,{...e}),n[1]):s.createElement(F,{...e}))},de=({transitionState:e,dmId:n})=>{const[t,i]=s.useState("");return s.createElement(v.ModalRoot,{transitionState:e},s.createElement(v.ModalHeader,null,s.createElement(Q,{tag:"h3"},"New Catgory")),s.createElement(v.ModalContent,null,s.createElement(w,{placeholder:"Category name",value:t,onChange:i},"New Category:")),s.createElement(v.ModalFooter,null,s.createElement(D,{disabled:!t,onClick:()=>{const a=d.persist.ghost.categories??[];a.push({name:t,dms:[n],pos:a.length,collapsed:!1}),d.persist.store.categories=a,X(),x()}},"Save")))};const{scroller:pe}=o.findByProps("privateChannelsHeaderContainer");function x(){const e=document.getElementsByClassName(pe)[0];!e||(e.dispatchEvent(new Event("focusin")),setTimeout(()=>{e.dispatchEvent(new Event("focusout"))},10))}function P(e,n){let t=[];const i=(d.persist.ghost.categories??[]).find(r=>r.dms.includes(e.id)),a=(d.persist.ghost.guildlist??[]).includes(e.id);if(i?t.push({type:"item",id:"remove-from-category",color:"colorDanger",label:`Remove from ${i.name}`,action(){i.dms=i.dms.filter(r=>r!==e.id),d.persist.store.categories[i.pos]=i,x()}}):t.push({type:"item",id:"catgory-submenu",label:"Pin to Channel List",items(){const r=[{type:"item",id:"create-new-catgory",color:"colorBrand",label:"Add to new catgory",action(){K(c.React.createElement(de,{dmId:e.id}))}},{type:"separator"}];return(d.persist.ghost.categories??[]).forEach(u=>r.push({type:"item",id:`add-to-category-${u.name}`,label:u.name,action(){u.dms.push(e.id),d.persist.store.categories[u.pos]=u,x()}})),[...r]}}),a?t.push({type:"item",id:"remove-from-list",label:"Unpin from Server List",color:"colorDanger",action:()=>{const r=(d.persist.ghost.guildlist??[]).filter(u=>u!==e.id);d.persist.store.guildlist=r,c.FluxDispatcher.dispatch({type:"PDM_GUILDLIST_REMOVE"})}}):t.push({type:"item",id:"add-to-list",label:"Pin to Server List",action:()=>{const r=d.persist.ghost.guildlist??[];r.push(e.id),d.persist.store.guildlist=r,c.FluxDispatcher.dispatch({type:"PDM_GUILDLIST_ADD"})}}),n){const r=t;t=[{type:"item",label:"PinDMs",id:"submenu",items:()=>[...r]}]}return re({items:t,rawItems:n})}const{GroupDM:ue,DirectMessage:fe}=o.findByProps("DirectMessage"),{getChannel:he}=o.findByProps("getChannel","hasChannel");var U=({channelId:e,selected:n})=>{const t=he(e);return t?t.type===3?s.createElement(ue,{channel:t,selected:n,tabIndex:-1}):s.createElement(fe,{channel:t,selected:n,tabIndex:-1}):null};const I={...o.findByProps("privateChannelsHeaderContainer"),...o.findByProps("containerDefault","name")};var me=({category:e})=>{const[n,t]=s.useState(e.collapsed);return e.dms.length?s.createElement(J,{tabIndex:-1,className:[I.clickable,"cc-pd-header"].join(" "),onClick:()=>{e.collapsed=!n,d.persist.store.categories[e.pos]=e,x(),t(!n)}},s.createElement(Y,{className:I.privateChannelsHeaderContainer},s.createElement("span",{className:I.headerText},e.name),s.createElement(Z,{className:"cc-pd-arrow",direction:n?"LEFT":"DOWN"}))):null};const{default:ye}=o.findByProps("DirectMessage"),Ee=o.findByDisplayName("ConnectedPrivateChannelsList",!1),{openContextMenu:Ce}=o.findByProps("openContextMenu"),{lastMessageId:j}=o.findByProps("lastMessageId");function ge(){this.injections.push(h.after("render",ye.prototype,function(e,n){const t=n.props.children({role:"listitem"});return n.props.children=()=>{const i=c.React.createElement(T,{text:"Pin",position:"top"},c.React.createElement(L,{className:"cc-pd-pin",onClick:a=>{a.preventDefault();const r=P(this.props.channel);Ce(a,()=>r)},icon:L}));return t.props.children.props.children.splice(1,0,i),t},n})),this.injections.push(h.after("default",Ee,(e,n)=>{const t=N.findInReactTree(n,r=>r?.privateChannelIds);if(!t)return n;const i=[],a=d.persist.ghost.categories??[];return a.forEach(r=>i.push(...r.dms)),t.privateChannelIds=t.privateChannelIds.filter(r=>!i.includes(r)),t.children=[...t.children],a.forEach(r=>{const u=c.React.createElement(me,{category:r});if(t.children.push(u),r.collapsed){if(r.dms.includes(t.selectedChannelId)){const l=r.dms.find(f=>f===t.selectedChannelId);if(!l)return;t.children.push(c.React.createElement(U,{channelId:l,selected:!0}))}}else{const l=r.dms.sort((f,y)=>j(y)-j(f)).map(f=>c.React.createElement(U,{channelId:f,selected:t.selectedChannelId===f}));t.children.push(...l)}}),n}))}const{default:xe}=o.findByProps("DirectMessage"),{getUser:Me}=o.findByProps("getUser","findByTag"),{isMobileOnline:ve,getStatus:O,getState:De}=o.findByProps("isMobileOnline"),{getChannel:be}=o.findByProps("getDMFromUserId"),{listItemTooltip:Pe}=o.findByProps("listItemTooltip"),{openContextMenu:Ie}=o.findByProps("openContextMenu"),{transitionTo:Be}=o.findByProps("transitionTo"),{getMentionCount:k}=o.findByProps("getMentionCount"),Ne=o.findByDisplayName("AnimatedHalfPill");var Te=()=>{const[e,n]=s.useState(d.persist.ghost.guildlist??[]);return s.useEffect(()=>{const t=({removeAll:i})=>n(i?[]:[...d.persist.ghost.guildlist??[]]);return c.FluxDispatcher.subscribe("PDM_GUILDLIST_ADD",t),c.FluxDispatcher.subscribe("PDM_GUILDLIST_REMOVE",t),()=>{c.FluxDispatcher.unsubscribe("PDM_GUILDLIST_ADD",t),c.FluxDispatcher.unsubscribe("PDM_GUILDLIST_REMOVE",t)}}),e.map(t=>s.createElement(Le,{channelId:t}))};function Le({channelId:e}){const[n,t]=s.useState(!1),[i,a]=s.useState(!1),[r,u]=s.useState(!!k(e)),l=be(e);if(!l)return null;const f=Me(l.recipients[0]),[y,z]=s.useState(O(f?.id)),E=xe.prototype.renderAvatar.call({props:{user:f,channel:l,status:y,isMobile:ve.bind({getState:()=>De()})(f?.id)}});return E.props.src=E.props.src.replace("size=32","size=64"),s.useEffect(()=>{const b=g=>g.user?.id===f?.id&&z(O(g.user.id)),$=g=>{g.channelId===l.id?a(!0):a(!1)},V=g=>g.id===e&&u(!!k(e));return c.FluxDispatcher.subscribe("PRESENCE_UPDATE",b),c.FluxDispatcher.subscribe("PDM_UPDATE",V),c.FluxDispatcher.subscribe("CHANNEL_SELECT",$),()=>{c.FluxDispatcher.unsubscribe("PRESENCE_UPDATE",b),c.FluxDispatcher.unsubscribe("CHANNEL_SELECT",$),c.FluxDispatcher.unsubscribe("PDM_UPDATE",V)}}),s.createElement(T,{text:l.type===3?l.name:f.username,position:"left","aria-label":!1,tooltipClassName:Pe},s.createElement("div",{onMouseEnter:()=>t(!0),onMouseLeave:()=>t(!1),onContextMenu:b=>{Ie(b,()=>P(l))},onClick:()=>Be(c.constants.Routes.CHANNEL("@me",l.id)),className:"cc-pd-guildpins"},s.createElement(Ne,{className:"pill-L_aLMQ",unread:r,selected:i,hovered:n}),E))}const Se=o.findByProps("HomeButton"),_e=o.findByDisplayName("TransitionGroup",!1);function Ae(){this.injections.push(h.after("HomeButton",Se,(e,n)=>(Array.isArray(n)||(n=[n]),(d.persist.ghost.guildlist??[]).includes(n[0].props.selectedChannelId)&&(n[0].props.selected=!1),n.push(c.React.createElement(Te)),n))),this.injections.push(h.after("render",_e.default.prototype,(e,n)=>(n.props.children.length&&n.props.children.forEach((t,i)=>{(d.persist.ghost.guildlist??[]).includes(t.key.replace(".$",""))&&(n.props.children.splice(i,1),c.FluxDispatcher._dispatch({type:"PDM_UPDATE",id:t.key.replace(".$","")}))}),n)))}const Re=["DMUserContextMenu","GroupDMUserContextMenu","GroupDMContextMenu"],{getDMFromUserId:G,getChannel:H}=o.findByProps("getDMFromUserId");async function B(e,n){const t=o.findByProps("openContextMenuLazy");this.injections.push(h.before("openContextMenuLazy",t,i=>{const a=i[1];return i[1]=async()=>{const r=await a(i[0]);return u=>{const l=r(u);return console.log(l),!l.props.message&&!l.props.guild&&!l.props.guildId&&h.after("type",l,(f,y)=>(y?.props?.children?.type&&h.after("type",y.props.children,(z,E)=>(E?.props?.children?.type?.displayName===e&&n(E.props.children),E),!0),y),!0),l}},i}))}function Fe(){B=B.bind(this),Re.forEach(e=>{B(e,n=>h.after("type",n,([t],i)=>{const a=N.findInReactTree(i,u=>Array.isArray(u)&&u.find(l=>l?.props?.id==="user-profile"||l?.props?.id==="remove-icon"));if(!a)return i;if(!!(t.channel||H(G(t.user.id))))return a.push(P(t.channel||H(G(t.user.id)),!0)),i},!0))})}var C={Categories:ge,GuildList:Ae,ContextMenus:Fe},we=()=>h.injectCSS(".channel-1Shao0>.interactive-1vLZ_I{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}.cc-pd-pin{width:15px;min-width:15px;min-height:15px;height:15px;display:none;opacity:.4}.channel-1Shao0>.interactive-1vLZ_I:hover .cc-pd-pin{display:block;opacity:.8}.cc-pd-guildpins{display:flex;justify-content:center;position:relative;cursor:pointer}.cc-pd-guildpins .wrapper-1VLyxH{margin-bottom:8px;height:48px!important;width:48px!important}.cc-pd-header{display:flex;justify-content:center;align-items:center}.cc-pd-arrow{height:18px;width:18px}.cc-pd-arrow>polygon{fill:var(--channels-default)}.cc-pd-header:hover .cc-pd-arrow polygon{fill:var(--interactive-hover)}.cc-pp-setting-input{display:flex}.cc-pp-setting-input .inputWrapper-1YNMmM{width:-webkit-fill-available}.cc-pp-setting-input button{margin-left:9px;min-width:130px;min-height:40px}");function Ue({category:e,onDelete:n}){const[t,i]=s.useState(e.name);return s.createElement(w,{value:t,onChange:a=>{e.name=a,d.persist.store.categories[e.pos]=e,i(a)}},t,s.createElement(D,{color:D.Colors.RED,onClick:()=>n?.(e.pos)},"Delete Category"))}var je=()=>{const[e,n]=s.useState(d.persist.ghost.categories??[]);return e?s.createElement("div",null,e.map(t=>s.createElement(Ue,{category:t,onDelete:i=>{e.splice(i,1),e.forEach((a,r)=>a.pos=r),d.persist.store.categories=e,n(null),setTimeout(()=>n(e))}})),s.createElement(D,{onClick:()=>{e.push({name:"New Category",dms:[],pos:e.length,collapsed:!1}),d.persist.store.categories=e,n(null),setTimeout(()=>n(e))}},"Add a category")):null};const M={};var Oe=()=>(Object.keys(C).forEach(e=>{M[e]=[],C[e]=C[e].bind({injections:M[e]})}),{onLoad(){Object.keys(C).forEach(e=>C[e]()),M.css=[we()]},onUnload(){Object.keys(C).forEach(e=>{M[e].forEach(n=>n?.())}),M.css[0]?.(),x(),c.FluxDispatcher.dispatch({type:"PDM_GUILDLIST_REMOVE",removeAll:!0})},settings:c.React.createElement(je)});return Oe})(cumcord.modules.common,cumcord.modules.webpack,cumcord.patcher,cumcord.utils,cumcord.modules,cumcord.pluginData,cumcord.modules.common.React);
