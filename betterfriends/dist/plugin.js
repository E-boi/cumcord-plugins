(function(v,s,t,b,z){"use strict";const{getRelationships:j}=s.webpack.findByProps("getRelationships"),{MenuItem:k}=s.webpack.findByProps("MenuGroup","MenuItem"),G=["DMUserContextMenu","GroupDMUserContextMenu","GuildChannelUserContextMenu"];function U(){const a=i=>j()[i]===1,e=i=>this.FAVORITE_FRIENDS.some(r=>r.id===i);G.forEach(i=>{const r=s.webpack.find(n=>n.default?.displayName===i);this.injections.ContextMenu.push(b.after("default",r,([{user:n}],c)=>{if(a(n.id)){const h=z.findInReactTree(c,d=>Array.isArray(d)&&d.find(l=>l&&l.props&&l.props.id==="block"));e(n.id)?h.push(t.React.createElement(k,{id:"ccbf-remove",label:"Remove Favorite",action:()=>{this.FAVORITE_FRIENDS=this.FAVORITE_FRIENDS.filter(d=>d.id!==n.id),this.settings.set("favfriends",this.FAVORITE_FRIENDS),this.reload("ContextMenu")}})):h.push(t.React.createElement(k,{id:"ccbf-add",label:"Add as Favorite",action:()=>{this.FAVORITE_FRIENDS.push({id:n.id,since:Date.now()}),this.settings.set("favfriends",this.FAVORITE_FRIENDS),this.reload("ContextMenu")}}))}return c})),r.default.displayName=i})}const N=s.webpack.findByProps("push","popWithKey"),x=s.webpack.findByProps("TooltipContainer").TooltipContainer,I=s.webpack.findByDisplayName("ArrowDropDown"),S=s.webpack.findByDisplayName("ArrowDropUp"),K=a=>t.React.createElement("span",{...a,className:`${a.className||""} ${s.webpack.findByProps("editIcon").editIcon}`}),V=s.webpack.findByDisplayName("ConfirmModal"),u=s.webpack.findByDisplayName("Text"),Q=s.webpack.findByDisplayName("Mention"),H=a=>N.push(()=>t.React.createElement(a)),D=()=>N.pop(),q={...s.webpack.findByProps("topSection")};var F=({header:a})=>t.React.createElement("div",{className:`ccbf-badge ${q.topSection}`},t.React.createElement(x,{className:"cssbf-star-tooltip",text:"Favorited Friend",position:"top"},t.React.createElement("div",{className:`${!a&&"ccbf-star-member"} ccbf-star`})));const Z=s.webpack.find(a=>a.default?.name==="b"&&!a.default?.displayName),J=s.webpack.findByDisplayName("MemberListItem").prototype;function W(){if(!this.settings.get("displaystar"))return;const a=e=>this.FAVORITE_FRIENDS.some(i=>i.id===e);this.injections.DisplayStar.push(b.after("renderDecorators",J,(e,i)=>(a(i._owner.pendingProps.user?.id)&&i.props.children.unshift(t.React.createElement(F)),i))),this.injections.DisplayStar.push(b.after("default",Z,([{message:e}],i)=>(a(e?.author?.id)&&i.props.children[1].props.children.push(t.React.createElement(F,{header:!0})),i)))}const C={...s.webpack.findByProps("privateChannelsHeaderContainer")};var Y=({friends:a,_this:e,expanded:i})=>{const[r,n]=t.React.useState(i);return!a||a.length===0?null:t.React.createElement("h2",{className:`ccbf-fav-friends-header ${C.privateChannelsHeaderContainer} container-2ax-kl`},t.React.createElement("span",{className:C.headerText},"Favorite Friends"),t.React.createElement("svg",{className:`ccbf-expand-fav-friends ${r?"expanded":"collapsed"}`,height:15,width:15,viewBox:"0 0 20 20",onClick:()=>{e.expanded=!r,n(e.expanded),document.querySelector(".scroller-1JbKMe").dispatchEvent(new Event("focusin")),document.querySelector(".scroller-1JbKMe").dispatchEvent(new Event("focusout"))}},t.React.createElement("path",{fill:"var(--channels-default)",d:"M4.516 7.548c0.436-0.446 1.043-0.481 1.576 0l3.908 3.747 3.908-3.747c0.533-0.481 1.141-0.446 1.574 0 0.436 0.445 0.408 1.197 0 1.615-0.406 0.418-4.695 4.502-4.695 4.502-0.217 0.223-0.502 0.335-0.787 0.335s-0.57-0.112-0.789-0.335c0 0-4.287-4.084-4.695-4.502s-0.436-1.17 0-1.615z"})))};const{getGuild:X}=s.webpack.findByProps("getGuild"),{getUser:$}=s.webpack.findByProps("getUser"),{getChannel:ee}=s.webpack.findByProps("getChannel"),{transitionTo:te}=s.webpack.findByProps("transitionTo"),{marginBottom20:E}=s.webpack.findByProps("marginBottom20");s.webpack.find(a=>a.prototype?.toISOString);var ie=({user:a,channel:e,friend:i})=>{const r=$(a),n=e&&ee(e),c=n&&X(n.guild_id);return console.log(i),t.React.createElement(V,{red:!1,transitionState:0,header:`${r.username} Information`,cancelText:"Alright",onCancel:D,onClose:()=>{}},t.React.createElement("div",{className:"ccbf-information-modal"},!n&&t.React.createElement(u,{size:u.Sizes.SIZE_16,className:E},r.username," hasn't been seen anywhere recently."),n&&t.React.createElement(u,{size:u.Sizes.SIZE_16,className:E},r.username," was last seen in"," ",c?t.React.createElement(Q,{iconType:"text",onClick:()=>{te?.(t.constants.Routes.CHANNEL(c.id,n.id)),D()}},n.name):n.recipients.length<=2?"your DMs":n.name),t.React.createElement(u,{size:u.Sizes.SIZE_16,className:E},"Favorite friend since ",new Date(i.since).toLocaleDateString()," ",new Date(i.since).toLocaleTimeString()),t.React.createElement(u,{size:u.Sizes.SIZE_16,className:E},"Joined discord on ",r.createdAt.toLocaleDateString()," ",r.createdAt.toLocaleTimeString())))};const M=s.webpack.find(a=>a.default?.displayName==="ConnectedPrivateChannelsList"),ne=s.webpack.findByDisplayName("PrivateChannel").prototype,{getChannel:w}=s.webpack.findByProps("getChannel"),{DirectMessage:ae}=s.webpack.findByProps("DirectMessage"),{getDMFromUserId:R}=s.webpack.findByProps("getDMFromUserId");function se(){this.expanded=!1,this.injections.FavoriteFriends.push(b.after("render",ne,(a,e)=>{const i=e.props.subText?._owner?.pendingProps?.channel?.recipients?.[0];return i&&this.FAVORITE_FRIENDS.some(r=>r.id===i)&&(e.props.className.includes("ccbf-favoritefriend")||(e.props.className+=" ccbf-favoritefriend"),e.props.children=[t.React.createElement(x,{text:"User Information",position:"top"},t.React.createElement(K,{className:"ccbf-information",onClick:r=>{r.stopPropagation(),r.preventDefault();const n=this.FRIEND_DATA.lastMessageID[i];H(()=>t.React.createElement(ie,{user:i,channel:n?.channel,friend:this.FAVORITE_FRIENDS.find(c=>c.id===i)}))}})),e.props.children]),e})),this.injections.FavoriteFriends.push(b.after("default",M,(a,e)=>{if(e.props.privateChannelIds=e.props.privateChannelIds.filter(n=>{const c=w(n);return c.type!==1||!this.FAVORITE_FRIENDS.some(h=>c.recipients[0]===h.id)}),e.props.children.find(n=>n?.toString()?.includes("()=>t")))return e;const i=t.React.createElement(Y,{_this:this,expanded:this.expanded,friends:this.FAVORITE_FRIENDS}),r=this.FAVORITE_FRIENDS.map(n=>()=>w(R(n.id))&&!this.expanded&&t.React.createElement(ae,{"aria-posinset":7,"aria-setsize":54,tabIndex:-1,channel:w(R(n.id)),selected:e.props.selectedChannelId===R(n.id)}));return e.props.children.push(()=>i,...r),e})),M.default.displayName="ConnectedPrivateChannelsList"}const re={...s.webpack.findByProps("iconContainer")},T=s.webpack.findByProps("GuildIcon").GuildIcon;var oe=({guild:a})=>t.React.createElement(x,{text:a.name,position:"top"},t.React.createElement("div",{className:`${re.iconContainer} ccbf-icon`},t.React.createElement(T,{animate:!0,size:T.Sizes.LARGE,guild:a})));const O=s.webpack.findByDisplayName("Flex"),{Messages:A}=t.i18n,g=s.webpack.findByProps("headerCell"),ce=s.webpack.findByDisplayName("SearchBar"),m=()=>{document.querySelector(".peopleList-3c4jOR").dispatchEvent(new Event("focusin")),setTimeout(()=>document.querySelector(".peopleList-3c4jOR").dispatchEvent(new Event("focusout")))};var le=({title:a,_this:e})=>{const[i,r]=t.React.useState(e.sortKey),[n,c]=t.React.useState(e.sortReversed),[h,d]=t.React.useState(e.searchQuery);return t.React.createElement(O,{align:O.Align.CENTER},t.React.createElement("div",{className:`ccbf-header ccbf-nameCell ${g.headerCell}`},t.React.createElement("div",{className:g.headerCellContent},a)),[{key:"usernameLower",label:A.FRIENDS_COLUMN_NAME},{key:"statusIndex",label:A.FRIENDS_COLUMN_STATUS},{key:"isFavorite",label:"Favorite"}].map(l=>t.React.createElement("div",{className:["ccbf-header ccbf-nameCell",g.headerCell,i===l.key&&g.headerCellSorted,g.clickable].join(" "),onClick:()=>{i===l.key?n?(r(""),c(!1),e.sortKey="",e.sortReversed=!1,m()):(c(!0),e.sortReversed=!0,m()):(r(l.key),c(!1),e.sortKey=l.key,e.sortReversed=!1,m())}},t.React.createElement("div",{className:g.headerCellContent},l.label,i===l.key&&n?t.React.createElement(I,{className:g.sortIcon}):t.React.createElement(S,{className:g.sortIcon})))),t.React.createElement(ce,{query:h,placeholder:"name",onChange:l=>{d(l),e.searchQuery=l,setTimeout(()=>m(),100)},onClear:()=>{d(""),e.searchQuery=""}}))};const{Messages:pe}=t.i18n,{RelationshipTypes:y,StatusTypes:de}=t.constants,L=s.webpack.findByDisplayName("TabBar").prototype,fe=s.webpack.findByDisplayName("FriendRow").prototype,{getRelationships:he}=s.webpack.findByProps("getRelationships"),{getStatus:be}=s.webpack.findByProps("getStatus"),B=s.webpack.find(a=>a.default?.displayName==="PeopleListSectionedNonLazy"),ue={online:0,streaming:1,idle:2,dnd:3,offline:4,invisible:5,unknown:6};function ge(){this.sortKey="",this.sortReversed=!1,this.searchQuery="";const a=()=>{console.log(L),this.injections.FriendsList.push(b.after("render",L,(r,n)=>{if(n.props["aria-label"]!==pe.FRIENDS)return n;const c=he(),h=Object.entries(c).filter(o=>o[1]===y.FRIEND&&be(o[0])!==de.OFFLINE).length,d=Object.values(c).filter(o=>o===y.FRIEND).length,l=Object.values(c).filter(o=>o===y.PENDING_INCOMING).length,f=Object.values(c).filter(o=>o===y.PENDING_OUTGOING).length,p=Object.values(c).filter(o=>o===y.BLOCKED).length;return n.props.children.forEach(o=>{switch(o.props.id){case"ONLINE":o.props.children+=` - ${h}`;break;case"ALL":o.props.children+=` - ${d}`;break;case"PENDING":Array.isArray(o.props.children)?o.props.children[1]=null:o.props.children=[o.props.children+=" - "],o.props.children.push(t.React.createElement(x,{text:"Incoming",position:"bottom",children:t.React.createElement(I,{className:"bfl-down",height:"20"})}),l,t.React.createElement(x,{text:"Outgoing",position:"bottom",children:t.React.createElement(S,{className:"bfl-down",height:"20"})}),f);break;case"BLOCKED":o.props.children+=` - ${p}`;break}}),n}))},e=()=>{this.injections.FriendsList.push(b.after("render",fe,(r,n)=>{const c=n.props.children,h=n._owner.stateNode.props.mutualGuilds;return n.props.children=(...d)=>{const l=c(...d);return l.props.children.splice(1,0,t.React.createElement("div",{className:"ccbf-mutualGuilds ccbf-container"})),h.forEach(f=>{const p=t.React.createElement(oe,{guild:f});l.props.children[1].props.children?l.props.children[1].props.children.unshift(p):l.props.children[1].props.children=[p]}),l},n}))},i=()=>{this.injections.FriendsList.push(b.after("default",B,(r,n)=>{const c=n.props.children.props.children;return n.props.children.props.children=(...h)=>{const d=c(...h),l=d.props.children[0].props.children[0].props;return l.title=[t.React.createElement(le,{title:l.title,_this:this})],d.props.children[0].props.children=d.props.children[0].props.children.map(f=>(f.props||(this.sortKey&&(f=f.map(p=>(p.statusIndex=ue[p.props.status],p.isFavorite=this.FAVORITE_FRIENDS.some(o=>o.id===p.key),p)),this.sortKey==="isFavorite"&&(f=f.filter(p=>p[this.sortKey])),f.sort((p,o)=>{let _=this.sortKey==="statusIndex"?p[this.sortKey]:p.props[this.sortKey],P=this.sortKey==="statusIndex"?o[this.sortKey]:o.props[this.sortKey];return _<P?-1:_>P?1:0})),this.searchQuery&&(f=f.filter(p=>p.props.usernameLower.includes(this.searchQuery))),this.sortReversed&&f.reverse()),f)),d},n})),B.default.displayName="PeopleListSectionedNonLazy"};this.settings.get("showtotal")&&a(),this.settings.get("mutualguilds")&&e(),this.settings.get("sortoptions")&&i()}function xe(){const a=({message:e})=>{this.FAVORITE_FRIENDS.some(i=>i.id===e.author.id)&&(this.FRIEND_DATA.lastMessageID[e.author.id]={id:e.id,channel:e.channel_id})};this.injections.InformationModal.push(()=>t.FluxDispatcher.unsubscribe("MESSAGE_CREATE",a)),this.settings.get("infomodal")?t.FluxDispatcher.subscribe("MESSAGE_CREATE",a):t.FluxDispatcher.unsubscribe("MESSAGE_CREATE",a)}var ye={ContextMenu:U,DisplayStar:W,InformationModal:xe,FavoriteFriends:se,FriendsList:ge},Ee=()=>cumcord.patcher.injectCSS(`.ccbf-friend{margin:6px;width:32px;height:32px;float:left;border-radius:360px}.ccbf-favoritefriend>.layout-2DM8Md>.children-gzQq2t{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:0 0 auto}.ccbf-favoritefriend>.layout-2DM8Md>.children-gzQq2t [aria-label="User Information"]{margin:0 5px}.ccbf-friend-name{color:#fff;float:left;font-family:"Whitney","Helvetica Neue","Helvetica","Arial",sans-serif;font-weight:700;margin-left:8px;font-size:20px}.ccbf-friend-discrim{color:#fff9;float:left;font-family:"Whitney","Helvetica Neue","Helvetica","Arial",sans-serif;font-size:16px;position:relative;top:4px;padding-right:6px}.ccbf-friend-discrim.ccbf-friend-discrim:before{content:"#"}.ccbf-friend-name,.ccbf-friend-discrim{margin-top:8px}.ccbf-star{display:inline;position:relative;top:6px;margin-left:5px;padding-right:5px;padding-left:5px;background:url(https://cdn.discordapp.com/attachments/770304534203334678/891085095459512340/e4d52f4d69d7bba67e5fd70ffe26b70d.png) no-repeat;background-size:10px 10px}.ccbf-star-member{margin-left:4px}.ccbf-badge,.ccbf-badge.topSectionNormal-2-vo2m{background:none;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex}.ccbf-badge~.botTagRegular-2HEhHi{margin-left:8px}.privateChannels-1nO12o .ccbf-badge,.badges>.ccbf-badge{height:20px!important;width:auto!important}.ccbf-information{left:82%;display:none;opacity:.4}.ccbf-fav-friends-header{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.ccbf-expand-fav-friends{margin-left:auto;cursor:pointer;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.ccbf-expand-fav-friends.expanded{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.ccbf-information:hover{opacity:.9}.channel-2QD9_O:hover .ccbf-information{display:block}.ccbf-user-settings{width:auto!important;margin-bottom:32px;border-radius:5px;padding:10px 10px 0}.ccbf-friend-item{padding:6px 6px 6px 18px;margin-top:4px;margin-bottom:4px;height:auto}.ccbf-notification-sounds{width:auto!important;padding-bottom:64px}.ccbf-notification-sounds-icon{background:url(https://canary.discordapp.com/assets/f9b93aa0d9985bd2b678da58ed0d75d2.svg) 50% no-repeat!important;width:auto;height:auto}.ccbf-notification-sounds>div>div>div>.divider-3573oO.marginTop20-3TxNs6{display:none}.searchBar-2_Yu-C{width:100%}html body .ccbf-ff-header{display:-webkit-box!important;display:-ms-flexbox!important;display:flex!important;-webkit-box-align:center;-ms-flex-align:center;align-items:center}html body .ccbf-ff-header svg{margin-right:5px;-webkit-transition:.2s;transition:.2s;width:18px;height:18px;-webkit-transform-origin:50% 50%;transform-origin:50% 50%}html body .ccbf-ff-header.opened svg{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.ccbf-status-userinline{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;display:-webkit-box;display:-ms-flexbox;display:flex}.ccbf-status-popup{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;background-color:#212121}.ccbf-status-popup .header{background-color:transparent;-webkit-box-shadow:none;box-shadow:none;padding:0;position:absolute;top:8px;right:8px}.ccbf-status-popup .header>span{display:none}.ccbf-status-popup .contents{padding:0}.ccbf-status-popup .contents .inner{background-color:transparent;border:none;padding-bottom:0;margin-bottom:2px}.ccbf-status-popup-text{color:#fff;font-weight:600;margin-right:8px}.pc-scroller{max-height:300px}.ccbf-container{-webkit-box-sizing:border-box;box-sizing:border-box;text-overflow:ellipsis;white-space:nowrap;text-transform:uppercase;font-size:12px;line-height:16px;font-weight:600;-webkit-box-flex:1;-ms-flex:1 1 auto;flex:1 1 auto;color:var(--channels-default)}.ccbf-mutualGuilds{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse;margin-right:15px;margin-bottom:10px;position:inherit}.ccbf-mutualGuilds .icon-3o6xvg{border-radius:12px}.ccbf-mutualGuilds>div{margin-right:-5px}.ccbf-header{border-left:2px solid var(--background-modifier-accent);-webkit-box-sizing:border-box;box-sizing:border-box}.headerCellContent-1pLtOr{margin:auto}.ccbf-nameCell{width:-webkit-min-content;width:-moz-min-content;width:min-content;padding:0 30px}@media screen and (max-width: 975px){.ccbf-nameCell{padding:0 10px}}@media screen and (min-width: 1200px){.ccbf-nameCell{padding:0 10px}}@media screen and (min-width: 1400px){.ccbf-nameCell{padding:0 30px}}@media screen and (min-width: 1500px){.ccbf-nameCell{padding:0 40px}}.ccbf-icon>div{height:30px;width:30px;line-height:32px!important;font-size:14px!important}
`);const me=[["favfriends",[]],["notifsounds",{}],["infomodal",!0],["displaystar",!0],["statuspopup",!0],["showtotal",!0],["mutualguilds",!0],["sortoptions",!0]];class we{constructor(e){this.settings=new Re(e),this.FRIEND_DATA={statusStorage:{},lastMessageID:{}},this.FAVORITE_FRIENDS=this.settings.get("favfriends")||[],this.MODULES=ye,this.injections={},this.css=null}onLoad(){this.settings.get("favfriends")||me.forEach(e=>this.settings.set(e[0],e[1])),this.css=Ee(),Object.keys(this.MODULES).forEach(e=>{this.MODULES[e]=this.MODULES[e].bind(this),this.injections[e]=[]}),v.log(this.injections),this.load()}onUnload(){this.unload(),this.css?.(),v.log("bye")}load(e){e?this.MODULES[e]():Object.keys(this.MODULES).forEach(i=>{this.MODULES[i]()})}unload(e){e?this.injections[e].forEach(i=>i()):Object.keys(this.MODULES).forEach(i=>{this.injections[i].forEach(r=>r())})}reload(e){e?(this.unload(e),this.load(e)):(this.unload(),this.load())}}class Re{constructor(e){this.persist=e}get(e){return this.persist.ghost[e]}set(e,i){this.persist.store[e]=i}}var ve=({persist:a})=>new we(a);return ve})(cumcord.utils.logger,cumcord.modules,cumcord.modules.common,cumcord.patcher,cumcord.utils);
